name: docs

on:
    push:
        branches: ["releases-*"]

jobs:
    build-and-test:
        runs-on: ubuntu-latest
        name: Build and deploying docs
        steps:
            - name: Checkout repository 🛎
              uses: actions/checkout@v2
              with:
                  fetch-depth: 0
            - name: Set up git 📝
              run: |
                  git config --global user.email "notesforamit@gmail.com"
                  git config --global user.name "Amit Joshi"
            - name: Set up Python 3.8
              uses: actions/setup-python@v1
              with:
                python-version: 3.8
            - name: Install pypa/build
              run: >-
                python -m
                pip install
                build
                --user
            - name: Build a binary wheel and a source tarball
              run: >-
                python -m
                build
                --sdist
                --wheel
                --outdir dist/
            - name: Install mkdocs material
              run: >-
                pip install
                mkdocs-material 
                mkdocstrings mkdocs-git-revision-date-localized-plugin
                mike cyclonedx-bom mdbom pip-licenses mkapi
            - name: Generate BOM Reports 📝
              run: |
                make bom
                make bom-report-md
            - name: Deploy docs 📦️
              env:
                  GH_TOKEN: ${{ secrets.GH_Token }}
              run: |
                  make publish-docs
